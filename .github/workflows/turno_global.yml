name: ⚙️ Turno Global do GitNations

# 1. Agendamento e Gatilhos: Roda diariamente e permite acionamento manual
on:
  schedule:
    # Roda todos os dias à meia-noite UTC (Ajuste para seu fuso se necessário)
    - cron: '0 0 * * *' 
  workflow_dispatch:
    # Permite rodar manualmente a partir da aba Actions

jobs:
  run_game_turn:
    runs-on: ubuntu-latest

    permissions:
      contents: write # ESSENCIAL: Permite que o Action faça commit dos arquivos JSON atualizados

    steps:
      - name: 📥 Checkout do Repositório
        uses: actions/checkout@v4
        with:
          # É preciso fazer um fetch do histórico completo para o commit funcionar
          fetch-depth: 0 

      - name: 🔧 Configurar Node.js (v20)
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: 📦 Instalar Dependências
        run: npm install # Se você tiver dependências no package.json

      - name: 🎮 Executar o Motor de Simulação
        run: node js/game.js

      - name: 💾 Commit das Estatísticas Atualizadas
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: '⚙️ Turno Global: Estatísticas das Nações Atualizadas'
          # Adiciona apenas os arquivos JSON alterados
          files: nations/*.json
          # Configuração para o bot de commit
          commit_user_name: GitNations Bot
          commit_user_email: actions@github.com
